 #Playbook ambiente node

 - name: Instalando pacotes
   hosts: servidoresweb
   tasks:
     - name: instalando nos servidores Ubuntu
       become: true
       apt:
         name: "{{ item }}"
         state: present
         update_cache: yes 
       loop:
         - mc
         - nginx
         - nodejs
         - npm
       when: ansible_distribution == "Ubuntu"

 - name: clonando repositorio
   hosts: ubuntu
   tasks:
     git:
       repo: https://github.com/arnab-datta/counter-app.git
       dest: /home/vagrant
       clone: yes
       update: yes   

  - name: buildando o projeto
    hosts: ubuntu
      shell: |
    	  cd counter-app
        npm install
        npm run build
        sudo mkdir /var/www/html/counter-app
        sudo cp -r build/. /var/www/html/counter-app/
      
 - name: Reiniciando servi√ßos
   hosts: ubuntu
   tasks:
     - name: reiniciando nginx
       become: true
       service:
         name: nginx
         state: started
         enabled: yes
       when: ansible_distribution == "Ubuntu"
    